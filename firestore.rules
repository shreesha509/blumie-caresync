
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Lock down by default
    match /{document=**} {
      allow read, write: if false;
    }

    // Rule for mood submissions. Only authenticated users can create their own mood entries.
    // We check against the `firebase_uid` field in the document.
    match /moods/{submissionId} {
      allow create: if request.auth != null && request.resource.data.firebase_uid == request.auth.uid;
      allow read, update: if request.auth != null && resource.data.firebase_uid == request.auth.uid;
    }

    // Warden access to all mood data.
    // This rule is illustrative. For production, you would use custom claims
    // to verify the user is a warden.
    match /moods/{moodId} {
      allow read: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'warden';
    }
    
    // Biometrics data can be read by the warden.
    match /biometrics/{bioId} {
       allow read: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'warden';
    }
  }
}
